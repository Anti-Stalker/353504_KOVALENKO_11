{% load crispy_forms_tags %}

<div class="card mb-4">
    <div class="card-header">
        <h5 class="mb-0">Фильтры</h5>
    </div>
    <div class="card-body">
        <form method="get" id="filter-form" class="row g-3">
            <div class="col-md-6">
                {{ filter_form.search|as_crispy_field }}
            </div>
            <div class="col-md-6">
                {{ filter_form.sort|as_crispy_field }}
            </div>
            <div class="col-md-6">
                {{ filter_form.date_from|as_crispy_field }}
            </div>
            <div class="col-md-6">
                {{ filter_form.date_to|as_crispy_field }}
            </div>
            <div class="col-12">
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-filter"></i> Применить фильтры
                </button>
                <a href="{% url 'analytics:dashboard' %}" class="btn btn-secondary">
                    <i class="fas fa-undo"></i> Сбросить
                </a>
            </div>
        </form>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('filter-form');
    const dateFrom = form.querySelector('[name="date_from"]');
    const dateTo = form.querySelector('[name="date_to"]');

    // Валидация дат на стороне клиента
    form.addEventListener('submit', function(e) {
        if (dateFrom.value && dateTo.value) {
            if (new Date(dateFrom.value) > new Date(dateTo.value)) {
                e.preventDefault();
                alert('Дата начала не может быть позже даты окончания');
            }
        }
    });

    // Ограничение максимальной даты текущим днем
    const today = new Date().toISOString().split('T')[0];
    dateFrom.max = today;
    dateTo.max = today;

    // Автоматическое обновление минимальной даты окончания
    dateFrom.addEventListener('change', function() {
        dateTo.min = this.value;
    });
});
</script> 